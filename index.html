<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GitHub 電子書閱讀器</title>
    <style>
        :root {
            --bg-color: #444;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            /* 使用 dvh (Dynamic Viewport Height) 解決手機網址列遮擋問題 */
            height: 100dvh; 
            width: 100vw;
            overflow: hidden; /* 禁止整個頁面滾動 */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            /* 禁止瀏覽器預設的滑動行為（如上一頁），讓 JS 專心處理翻頁 */
            touch-action: none; 
        }

        /* 主容器：採用垂直 Flex 佈局 */
        .viewport-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column; /* 上面是書，下面是按鈕 */
            justify-content: space-between; 
            align-items: center;
        }

        /* 1. 書本舞台區：佔據所有剩餘空間，並負責置中 */
        .stage-area {
            flex: 1; /* 自動填滿剩餘高度 */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            perspective: 1500px; /* 3D 視角 */
            padding: 20px; /* 給書本一點呼吸空間 */
        }

        /* 2. 書本本體：鎖定 9:16 比例 */
        .book {
            position: relative;
            transform-style: preserve-3d;
            
            /* --- 核心修正：比例鎖定 --- */
            /* 設定直式 16:9 (即 9:16) */
            aspect-ratio: 9 / 16;
            
            /* 讓書本盡可能大，但受限於舞台的高度或寬度 */
            height: 100%; 
            max-height: 100%; /* 不超過舞台高度 */
            width: auto;      /* 寬度自動計算 */
            
            /* 如果螢幕太寬（電腦），限制一下最大寬度，避免過大 */
            max-width: 100%; 

            border-radius: 4px;
            transition: transform 0.4s ease;
        }

        /* 頁面樣式 */
        .page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent; /* 透明背景 */
            border: none;
            
            transform-origin: left center;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1);
            
            /* 確保圓角裁切 */
            overflow: hidden; 
            border-radius: 4px;

            display: flex;
            justify-content: center;
            align-items: center;
            backface-visibility: hidden; 
        }

        .page img {
            width: 100%;
            height: 100%;
            /* 使用 contain 確保整張圖完整顯示且不變形 (可能會留白邊) */
            /* 如果您這張圖本身就是設計好的 9:16，用 cover 也可以 */
            object-fit: contain; 
            pointer-events: none; /* 防止圖片被選取，干擾滑動 */
        }

        .page.flipped {
            transform: rotateY(-180deg);
        }

        /* 3. 控制區：固定高度，確保不跑版 */
        .controls {
            flex-shrink: 0; /* 禁止被壓縮 */
            height: 80px;   /* 給予足夠的觸控高度 */
            width: 100%;
            
            display: flex;
            justify-content: center;
            align-items: center; /* 垂直置中 */
            gap: 15px;
            
            background: rgba(0, 0, 0, 0.2); /* 稍微深一點的背景區隔 */
            padding-bottom: env(safe-area-inset-bottom); /* 適配 iPhone 底部橫條 */
            z-index: 100;
        }

        /* 控制列內的小容器 */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        button {
            border: none;
            background: #333;
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }

        button:active { background: #555; }
        button:disabled { background: #ccc; opacity: 0.5; cursor: not-allowed; }

        .page-info {
            font-size: 14px;
            color: #333;
            font-variant-numeric: tabular-nums;
            min-width: 45px;
            text-align: center;
            font-weight: bold;
        }

        .jump-box {
            display: flex;
            align-items: center;
            gap: 5px;
            border-left: 1px solid #ccc;
            padding-left: 10px;
            margin-left: 5px;
        }

        input[type="number"] {
            width: 45px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
        }

        /* 手機適配微調 */
        @media (max-width: 400px) {
            .control-panel {
                padding: 8px 10px;
                gap: 5px;
                width: 95%;
                justify-content: space-between;
            }
            button { padding: 8px 10px; font-size: 13px; }
            .jump-box input { width: 35px; }
        }
    </style>
</head>
<body>

    <div class="viewport-container" id="touch-zone">
        <div class="stage-area">
            <div class="book" id="book">
                <div class="page" style="z-index: 2;" id="page-0">
                    <img src="0.JPG" alt="Page 0">
                </div>
                <div class="page" style="z-index: 1;" id="page-1">
                    <img src="1.JPG" alt="Page 1">
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-panel">
                <button id="btn-prev" onclick="prevPage()">上一頁</button>
                <span class="page-info">
                    <span id="current-page">1</span> / <span id="total-pages">2</span>
                </span>
                <button id="btn-next" onclick="nextPage()">下一頁</button>
                
                <div class="jump-box">
                    <input type="number" id="jump-input" min="1" placeholder="頁">
                    <button onclick="jumpToPage()">GO</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 設定圖片總數
        const totalImages = 2; 
        let currentPageIndex = 0; 

        // DOM 元素
        const pageCountSpan = document.getElementById('total-pages');
        const currentSpan = document.getElementById('current-page');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        const pages = document.querySelectorAll('.page');
        const touchZone = document.getElementById('touch-zone');

        function init() {
            pageCountSpan.innerText = totalImages;
            updateZIndexes();
            updateControls();

            // --- 修復滑動偵測 ---
            let touchStartX = 0;
            let touchEndX = 0;
            
            // 監聽整個容器，確保手指點在哪都能感應
            touchZone.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: false });
            
            // 重要：防止滑動時觸發瀏覽器的預設行為（如滾動頁面），讓滑動更靈敏
            touchZone.addEventListener('touchmove', e => {
                // 如果是水平滑動，阻止預設行為
                e.preventDefault(); 
            }, { passive: false });

            touchZone.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: false });

            function handleSwipe() {
                const threshold = 40; // 滑動靈敏度
                if (touchEndX < touchStartX - threshold) {
                    nextPage(); // 向左滑 -> 下一頁
                }
                if (touchEndX > touchStartX + threshold) {
                    prevPage(); // 向右滑 -> 上一頁
                }
            }
        }

        function updateZIndexes() {
            pages.forEach((page, index) => {
                if (index > currentPageIndex) {
                    page.style.zIndex = totalImages - index;
                    page.style.display = 'flex';
                } else if (index === currentPageIndex) {
                      page.style.zIndex = totalImages + 1;
                      page.style.display = 'flex';
                } else {
                    page.style.zIndex = index;
                }
            });
        }

        function nextPage() {
            if (currentPageIndex >= totalImages - 1) return;
            const currentEl = document.getElementById(`page-${currentPageIndex}`);
            currentEl.classList.add('flipped');
            currentPageIndex++;
            updateUI();
        }

        function prevPage() {
            if (currentPageIndex <= 0) return;
            currentPageIndex--;
            const prevEl = document.getElementById(`page-${currentPageIndex}`);
            prevEl.classList.remove('flipped');
            updateUI();
        }

        function jumpToPage() {
            const input = document.getElementById('jump-input');
            let targetPage = parseInt(input.value);

            if (isNaN(targetPage) || targetPage < 1 || targetPage > totalImages) {
                alert('請輸入有效的頁碼');
                return;
            }

            let targetIndex = targetPage - 1;

            if (targetIndex > currentPageIndex) {
                for (let i = currentPageIndex; i < targetIndex; i++) {
                    document.getElementById(`page-${i}`).classList.add('flipped');
                }
            } 
            else if (targetIndex < currentPageIndex) {
                for (let i = currentPageIndex - 1; i >= targetIndex; i--) {
                    document.getElementById(`page-${i}`).classList.remove('flipped');
                }
            }

            currentPageIndex = targetIndex;
            updateUI();
            input.value = '';
        }

        function updateUI() {
            currentSpan.innerText = currentPageIndex + 1;
            btnPrev.disabled = currentPageIndex === 0;
            btnNext.disabled = currentPageIndex === totalImages - 1;
            updateZIndexes();
        }

        init();
    </script>
</body>
</html>

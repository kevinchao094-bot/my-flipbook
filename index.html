<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GitHub 電子書閱讀器</title>
    <style>
        :root { --bg-color: #333; }
        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            height: 100dvh; /* 使用 dvh 確保填滿手機畫面 */
            width: 100vw;
            overflow: hidden; /* 禁止網頁捲動 */
            font-family: sans-serif;
            /* 告訴瀏覽器這裡的滑動行為由我們處理 */
            touch-action: none; 
            user-select: none; /* 禁止選取文字與圖片 */
            -webkit-user-select: none;
        }

        /* 主容器 */
        .viewport-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }

        /* 書本舞台區 */
        .stage-area {
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* 確保放大時圖片不超出去 */
            perspective: 1500px;
            padding: 10px;
            position: relative;
        }

        /* 提示文字 */
        .hint-text {
            position: absolute;
            top: 20px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            z-index: 50;
            pointer-events: none;
            opacity: 0.8;
        }

        /* 書本本體：鎖定 9:16 比例 */
        .book {
            position: relative;
            transform-style: preserve-3d;
            aspect-ratio: 9 / 16;
            height: 100%;
            max-height: 100%;
            width: auto;
            max-width: 100%;
        }

        /* 頁面 */
        .page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent;
            /* 翻頁動畫 */
            transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1);
            transform-origin: left center;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* 圖片容器：負責縮放與位移 */
        .img-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 縮放動畫：讓放大縮小有過渡效果 */
            transition: transform 0.3s ease-out;
            will-change: transform;
        }

        .page img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 確保完整顯示 */
            pointer-events: none; /* 讓點擊穿透到容器 */
        }

        /* 翻頁效果 */
        .page.flipped { transform: rotateY(-180deg); }
        .page.active { z-index: 10; }

        /* 控制列 */
        .controls {
            flex-shrink: 0;
            height: 80px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 100;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        button {
            border: none;
            background: #333;
            color: #fff;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 14px;
        }
        button:disabled { background: #ccc; opacity: 0.5; }
        
        .page-info { font-weight: bold; color: #333; min-width: 50px; text-align: center; }
        
        /* 輸入框微調 */
        .jump-box { display: flex; gap: 5px; border-left: 1px solid #ccc; padding-left: 10px; }
        input { width: 40px; text-align: center; border-radius: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <div class="viewport-container" id="touch-layer">
        <div class="stage-area">
            <div class="hint-text" id="status-hint">滑動翻頁 • 雙擊放大</div>
            
            <div class="book" id="book">
                <div class="page active" id="page-0">
                    <div class="img-container" id="zoom-container-0">
                        <img src="0.JPG" alt="Page 1">
                    </div>
                </div>
                <div class="page" id="page-1">
                    <div class="img-container" id="zoom-container-1">
                        <img src="1.JPG" alt="Page 2">
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-panel">
                <button id="btn-prev" onclick="manualPrev()">上一頁</button>
                <span class="page-info">
                    <span id="current-page">1</span> / <span id="total-pages">2</span>
                </span>
                <button id="btn-next" onclick="manualNext()">下一頁</button>
                
                <div class="jump-box">
                    <input type="number" id="jump-input" placeholder="頁">
                    <button onclick="jumpToPage()">GO</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 設定總頁數
        const totalImages = 2;
        let currentIndex = 0;

        // 縮放狀態管理
        let isZoomed = false;
        let currentScale = 1;
        let currentTranslateX = 0;
        let currentTranslateY = 0;

        // 觸控變數
        let lastTapTime = 0;
        let startX = 0;
        let startY = 0;
        let lastMoveX = 0;
        let lastMoveY = 0;
        let isDragging = false;

        // DOM 元素
        const touchLayer = document.getElementById('touch-layer');
        const hintText = document.getElementById('status-hint');

        // 初始化
        function init() {
            document.getElementById('total-pages').innerText = totalImages;
            updateUI();
            
            // 綁定觸控事件 (核心邏輯)
            touchLayer.addEventListener('touchstart', handleTouchStart, { passive: false });
            touchLayer.addEventListener('touchmove', handleTouchMove, { passive: false });
            touchLayer.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        // --- 1. 觸控開始 ---
        function handleTouchStart(e) {
            const touch = e.touches[0];
            const now = new Date().getTime();
            
            // 記錄起始位置
            startX = touch.clientX;
            startY = touch.clientY;
            lastMoveX = startX;
            lastMoveY = startY;
            isDragging = false;

            // 判斷雙擊 (Double Tap)
            if (now - lastTapTime < 300) {
                // 如果兩次點擊間隔小於 300ms，視為雙擊
                e.preventDefault(); // 防止瀏覽器原生縮放
                toggleZoom();
            }
            lastTapTime = now;
        }

        // --- 2. 觸控移動 ---
        function handleTouchMove(e) {
            e.preventDefault(); // 禁止瀏覽器預設捲動行為，這是滑動能生效的關鍵！

            if (e.touches.length > 1) return; // 暫不處理多指縮放
            
            const touch = e.touches[0];
            const deltaX = touch.clientX - lastMoveX;
            const deltaY = touch.clientY - lastMoveY;

            isDragging = true;

            // 邏輯分流：
            if (isZoomed) {
                // A. 縮放模式：移動圖片 (Pan)
                currentTranslateX += deltaX;
                currentTranslateY += deltaY;
                applyTransform();
            } else {
                // B. 正常模式：這裡只記錄，等到手指放開時判斷是否為翻頁滑動
                // (不需要即時反應，以免誤觸)
            }

            lastMoveX = touch.clientX;
            lastMoveY = touch.clientY;
        }

        // --- 3. 觸控結束 ---
        function handleTouchEnd(e) {
            // 如果是在縮放模式下拖曳，結束時不需要做翻頁判斷
            if (isZoomed) return;

            // 如果沒有明顯的拖曳行為，就不算滑動
            if (!isDragging) return;

            const endX = e.changedTouches[0].clientX;
            const diffX = endX - startX;
            const threshold = 50; // 滑動門檻值 (像素)

            // 判斷滑動方向
            if (Math.abs(diffX) > threshold) {
                if (diffX < 0) {
                    nextPage(); // 向左滑 -> 下一頁
                } else {
                    prevPage(); // 向右滑 -> 上一頁
                }
            }
        }

        // --- 縮放邏輯 (Zoom Logic) ---
        function toggleZoom() {
            if (isZoomed) {
                // 還原 (Reset)
                currentScale = 1;
                currentTranslateX = 0;
                currentTranslateY = 0;
                isZoomed = false;
                hintText.innerText = "滑動翻頁 • 雙擊放大";
                enableControls(true); // 啟用翻頁按鈕
            } else {
                // 放大 (Zoom In)
                currentScale = 2.5; // 放大倍率
                isZoomed = true;
                hintText.innerText = "拖曳移動 • 雙擊還原";
                enableControls(false); // 放大時禁用翻頁按鈕，避免誤觸
            }
            applyTransform();
        }

        function applyTransform() {
            // 獲取當前頁面的圖片容器
            const container = document.getElementById(`zoom-container-${currentIndex}`);
            if (container) {
                container.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;
            }
        }

        function resetZoom() {
            // 切換頁面時，強制重置所有縮放狀態
            if (isZoomed) {
                const prevContainer = document.getElementById(`zoom-container-${currentIndex}`);
                if (prevContainer) prevContainer.style.transform = `translate(0px, 0px) scale(1)`;
                
                isZoomed = false;
                currentScale = 1;
                currentTranslateX = 0;
                currentTranslateY = 0;
                hintText.innerText = "滑動翻頁 • 雙擊放大";
                enableControls(true);
            }
        }

        // --- 翻頁邏輯 ---
        function nextPage() {
            if (currentIndex >= totalImages - 1) return;
            resetZoom(); // 換頁前先重置縮放
            
            document.getElementById(`page-${currentIndex}`).classList.add('flipped');
            currentIndex++;
            updateUI();
        }

        function prevPage() {
            if (currentIndex <= 0) return;
            resetZoom();

            currentIndex--;
            document.getElementById(`page-${currentIndex}`).classList.remove('flipped');
            updateUI();
        }

        // 按鈕觸發
        function manualNext() { if(!isZoomed) nextPage(); }
        function manualPrev() { if(!isZoomed) prevPage(); }

        function jumpToPage() {
            const input = document.getElementById('jump-input');
            let targetPage = parseInt(input.value);
            if (isNaN(targetPage) || targetPage < 1 || targetPage > totalImages) return;
            
            resetZoom();
            let targetIndex = targetPage - 1;

            // 處理翻頁動畫
            if (targetIndex > currentIndex) {
                for (let i = currentIndex; i < targetIndex; i++) {
                    document.getElementById(`page-${i}`).classList.add('flipped');
                }
            } else {
                for (let i = currentIndex - 1; i >= targetIndex; i--) {
                    document.getElementById(`page-${i}`).classList.remove('flipped');
                }
            }
            currentIndex = targetIndex;
            updateUI();
            input.value = '';
        }

        // --- UI 更新 ---
        function updateUI() {
            // 更新 Z-Index 確保層級正確
            for (let i = 0; i < totalImages; i++) {
                const page = document.getElementById(`page-${i}`);
                if (i > currentIndex) {
                    page.style.zIndex = totalImages - i;
                    page.style.display = 'flex';
                } else if (i === currentIndex) {
                    page.style.zIndex = totalImages + 1;
                    page.style.display = 'flex';
                    page.classList.add('active');
                } else {
                    page.style.zIndex = i;
                    page.classList.remove('active');
                }
            }

            // 更新按鈕狀態
            document.getElementById('current-page').innerText = currentIndex + 1;
            document.getElementById('btn-prev').disabled = (currentIndex === 0);
            document.getElementById('btn-next').disabled = (currentIndex === totalImages - 1);
        }

        function enableControls(enabled) {
            document.getElementById('btn-prev').disabled = !enabled || currentIndex === 0;
            document.getElementById('btn-next').disabled = !enabled || currentIndex === totalImages - 1;
        }

        // 啟動
        init();
    </script>
</body>
</html>
